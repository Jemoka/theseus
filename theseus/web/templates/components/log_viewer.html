{#
Log viewer component - displays and streams job logs.

Usage:
    {% include "components/log_viewer.html" with job=job content=log_content %}

Props:
    job: JobMetadata object (for streaming endpoint)
    content: string - initial log content

Features:
- Auto-scroll to bottom
- HTMX polling for updates (when job is running)
- SSE streaming (optional, more efficient)

TODO:
- Add search/filter functionality
- Add ANSI color parsing
- Add download button
- Add line number gutter
- Add copy button
- Add word wrap toggle
#}
<div class="bg-gray-900 rounded-lg overflow-hidden">
    <!-- Header -->
    <div class="flex items-center justify-between px-4 py-2 bg-gray-800 border-b border-gray-700">
        <div class="flex items-center space-x-2">
            <span class="text-sm font-medium text-gray-200">Logs</span>
            {% if job.status.value == "running" %}
            <span class="flex items-center text-xs text-green-400">
                <span class="h-2 w-2 rounded-full bg-green-400 animate-pulse mr-1"></span>
                Live
            </span>
            {% endif %}
        </div>

        <div class="flex items-center space-x-2">
            <!-- TODO: Add toolbar buttons -->
            <!--
            <button class="text-gray-400 hover:text-white text-xs">
                Copy
            </button>
            <button class="text-gray-400 hover:text-white text-xs">
                Download
            </button>
            <button class="text-gray-400 hover:text-white text-xs">
                Wrap
            </button>
            -->

            <!-- Refresh button -->
            <button hx-get="/partials/log/{{ job.project or 'general' }}/{{ job.group or 'default' }}/{{ job.name }}/{{ job.run_id }}?tail=100"
                    hx-target="#log-content"
                    hx-swap="innerHTML"
                    class="text-gray-400 hover:text-white text-xs">
                Refresh
            </button>
        </div>
    </div>

    <!-- Log content -->
    <div id="log-container"
         class="h-96 overflow-auto p-4"
         {% if job.status.value == "running" %}
         hx-get="/partials/log/{{ job.project or 'general' }}/{{ job.group or 'default' }}/{{ job.name }}/{{ job.run_id }}?tail=100"
         hx-trigger="every 3s"
         hx-target="#log-content"
         hx-swap="innerHTML"
         {% endif %}>
        <pre id="log-content" class="log-content text-gray-200">{{ content }}</pre>
    </div>
</div>

<script>
// Auto-scroll to bottom on content update
document.body.addEventListener('htmx:afterSwap', function(evt) {
    if (evt.detail.target.id === 'log-content') {
        const container = document.getElementById('log-container');
        container.scrollTop = container.scrollHeight;
    }
});
</script>
