{% extends "base.html" %}

{% block title %}Checkpoint {{ checkpoint.suffix }} - THESEUS{% endblock %}

{% block content %}
<div class="space-y-4">
    <!-- Breadcrumb -->
    <nav class="breadcrumbs">
        <a href="/" class="breadcrumb-item no-style">theseus</a>
        <span class="breadcrumb-separator">/</span>
        <a href="/jobs" class="breadcrumb-item no-style">jobs</a>
        <span class="breadcrumb-separator">/</span>
        <a href="/jobs?project={{ checkpoint.project }}" class="breadcrumb-item no-style">{{ checkpoint.project }}</a>
        <span class="breadcrumb-separator">/</span>
        <a href="/jobs?project={{ checkpoint.project }}&group={{ checkpoint.group }}" class="breadcrumb-item no-style">{{ checkpoint.group }}</a>
        <span class="breadcrumb-separator">/</span>
        <a href="/jobs/{{ checkpoint.project }}/{{ checkpoint.group }}/{{ checkpoint.job_name }}/latest" class="breadcrumb-item no-style">{{ checkpoint.job_name }}</a>
        <span class="breadcrumb-separator">/</span>
        <span class="breadcrumb-item active">checkpoint: {{ checkpoint.suffix }}</span>
    </nav>

    <!-- Header -->
    <div class="mb-4">
        <h1 class="text-xl font-semibold uppercase tracking-wide">Checkpoint: {{ checkpoint.suffix }}</h1>
        <p class="text-xs text-gray-400 mt-1">
            Job: {{ checkpoint.job_name }}
        </p>
    </div>

    <!-- Info Grid -->
    <div class="grid grid-4 gap-3 mb-4">
        <!-- Created -->
        <div class="stat-card">
            <div class="stat-card-header">
                <div class="stat-label">Created</div>
            </div>
            <div class="stat-card-body">
                <div class="text-xs">{{ checkpoint.created | format_timestamp }}</div>
            </div>
        </div>

        <!-- Size -->
        <div class="stat-card">
            <div class="stat-card-header">
                <div class="stat-label">Size</div>
            </div>
            <div class="stat-card-body">
                <div class="text-xs font-mono">{{ checkpoint.size_bytes | format_size }}</div>
            </div>
        </div>

        <!-- Has Config -->
        <div class="stat-card">
            <div class="stat-card-header">
                <div class="stat-label">Config</div>
            </div>
            <div class="stat-card-body">
                <div class="text-xs">
                    {% if checkpoint.has_config %}
                    <span style="color: var(--green);">✓ Available</span>
                    {% else %}
                    <span class="text-gray-400">Not found</span>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Has Job Spec -->
        <div class="stat-card">
            <div class="stat-card-header">
                <div class="stat-label">Job Spec</div>
            </div>
            <div class="stat-card-body">
                <div class="text-xs">
                    {% if checkpoint.has_job_spec %}
                    <span style="color: var(--green);">✓ Available</span>
                    {% else %}
                    <span class="text-gray-400">Not found</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Main content area -->
    <div class="grid" style="grid-template-columns: 2fr 1fr; gap: var(--spacing-lg);">
        <!-- Config (2/3 width) -->
        <div>
            {% if config %}
            <div class="card" style="padding: 0;">
                <div class="card-header" style="background: var(--gray-1); padding: var(--spacing-sm) var(--spacing-md); margin: 0;">
                    <h3 class="text-xs font-semibold tracking-wide">Configuration</h3>
                </div>
                <div style="padding: var(--spacing-md); max-height: 600px; overflow: auto;">
                    <pre class="text-2xs font-mono text-gray-600" style="white-space: pre-wrap; word-break: break-all;">{{ config | tojson(indent=2) }}</pre>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Sidebar (1/3 width) -->
        <div class="space-y-3">
            <!-- Other checkpoints for this job -->
            {% if other_checkpoints %}
            <div class="card" style="padding: 0;">
                <div class="card-header" style="background: var(--gray-1); padding: var(--spacing-sm) var(--spacing-md); margin: 0;">
                    <h3 class="text-xs font-semibold tracking-wide">Other Checkpoints</h3>
                </div>
                <div style="max-height: 300px; overflow-y: auto;">
                    {% for ckpt in other_checkpoints %}
                    <a href="/checkpoints/{{ ckpt.project }}/{{ ckpt.group }}/{{ ckpt.job_name }}/{{ ckpt.suffix }}"
                       class="block border-b border-gray-200 p-3 hover:bg-gray-50 transition-colors no-style">
                        <div class="text-xs font-mono" style="color: var(--blue);">{{ ckpt.suffix }}</div>
                        <div class="text-2xs text-gray-400 mt-1">
                            {{ ckpt.created | format_timestamp }}
                            • {{ ckpt.size_bytes | format_size }}
                        </div>
                    </a>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Job Spec -->
            {% if job_spec %}
            <div class="card" style="padding: 0;">
                <div class="card-header" style="background: var(--gray-1); padding: var(--spacing-sm) var(--spacing-md); margin: 0;">
                    <h3 class="text-xs font-semibold tracking-wide">Job Specification</h3>
                </div>
                <div style="padding: var(--spacing-md); max-height: 400px; overflow: auto;">
                    <pre class="text-2xs font-mono text-gray-600" style="white-space: pre-wrap; word-break: break-all;">{{ job_spec | tojson(indent=2) }}</pre>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}