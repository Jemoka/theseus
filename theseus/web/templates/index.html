{% extends "base.html" %}

{% block title %}Dashboard - theseus{% endblock %}

{% block content %}
<div class="space-y-5">
    <!-- Page Header -->
    <div class="mb-5">
        <h1 class="text-xl font-semibold uppercase tracking-wide">Dashboard</h1>
        <p class="text-xs text-gray-400 mt-1">
            System overview and active operations
        </p>
    </div>

    <!-- Stats Grid -->
    <div id="stats-grid"
         class="grid grid-5 gap-3 mb-5"
         hx-get="/partials/stats"
         hx-trigger="every 30s"
         hx-swap="innerHTML">
        {% include "partials/stats.html" %}
    </div>

    <!-- Running Jobs Section -->
    <div class="mb-6">
        <div class="section-header">
            <h2 class="section-title">Running Jobs</h2>
            <a href="/jobs?status=running" class="text-2xs font-semibold tracking-wide no-style" style="color: var(--blue);">
                View all →
            </a>
        </div>

        <div id="running-jobs"
             hx-get="/partials/running-jobs"
             hx-trigger="every 10s"
             hx-swap="innerHTML">
            {% set jobs = running_jobs %}
            {% include "partials/running_jobs.html" %}
        </div>
    </div>

    <!-- Recent Jobs Section -->
    <div class="mb-6">
        <div class="section-header">
            <h2 class="section-title">Recent Jobs</h2>
            <a href="/jobs" class="text-2xs font-semibold tracking-wide no-style" style="color: var(--blue);">
                View history →
            </a>
        </div>

        {% if recent_jobs %}
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(min(340px, 100%), 1fr)); gap: var(--spacing-md);">
            {% for job in recent_jobs %}
            {% include "components/job_card.html" %}
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <p class="empty-state-text">No jobs in the last 24 hours</p>
        </div>
        {% endif %}
    </div>

    <!-- Projects Overview Table -->
    {% if stats.projects %}
    <div class="mb-6">
        <h2 class="section-title mb-3">Projects Overview</h2>

        <div class="table-responsive">
        <table>
            <thead>
                <tr>
                    <th>Project</th>
                    <th>Total</th>
                    <th>Running</th>
                    <th>Completed</th>
                    <th>Failed</th>
                    <th>Groups</th>
                    <th>Last Activity</th>
                </tr>
            </thead>
            <tbody>
                {% for project in stats.projects %}
                <tr>
                    <td>
                        <a href="/projects/{{ project.name }}" class="font-semibold no-style" style="color: var(--blue);">
                            {{ project.name }}
                        </a>
                    </td>
                    <td class="font-mono text-xs">{{ project.total_jobs }}</td>
                    <td>
                        {% if project.running > 0 %}
                        <span class="status status-running">{{ project.running }}</span>
                        {% else %}
                        <span class="text-gray-400 text-xs">0</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if project.completed > 0 %}
                        <span class="status status-completed">{{ project.completed }}</span>
                        {% else %}
                        <span class="text-gray-400 text-xs">0</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if project.failed > 0 %}
                        <span class="status status-failed">{{ project.failed }}</span>
                        {% else %}
                        <span class="text-gray-400 text-xs">0</span>
                        {% endif %}
                    </td>
                    <td class="font-mono text-xs">{{ project.groups | length }}</td>
                    <td class="text-2xs text-gray-400">
                        {% if project.last_activity %}
                        {{ project.last_activity }}
                        {% else %}
                        —
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
