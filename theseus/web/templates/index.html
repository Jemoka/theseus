{% extends "base.html" %}

{% block title %}Dashboard - Theseus{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Page Header -->
    <div>
        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Dashboard</h1>
        <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
            Overview of all running jobs and recent activity
        </p>
    </div>

    <!-- Stats Grid -->
    <div id="stats-grid"
         class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-5"
         hx-get="/partials/stats"
         hx-trigger="every 30s"
         hx-swap="innerHTML">
        {% include "partials/stats.html" %}
    </div>

    <!-- Main Grid -->
    <div class="grid grid-cols-1 gap-6 lg:grid-cols-3">
        <!-- Running Jobs (2/3 width) -->
        <div class="lg:col-span-2 space-y-4">
            <div class="flex items-center justify-between">
                <h2 class="text-lg font-medium text-gray-900 dark:text-white">Running Jobs</h2>
                <a href="/jobs?status=running" class="text-sm text-blue-600 dark:text-blue-400 hover:underline">
                    View all
                </a>
            </div>

            <div id="running-jobs"
                 hx-get="/partials/running-jobs"
                 hx-trigger="every 10s"
                 hx-swap="innerHTML">
                {% include "partials/running_jobs.html" with jobs=running_jobs %}
            </div>
        </div>

        <!-- Recent Alerts (1/3 width) -->
        <div class="space-y-4">
            <div class="flex items-center justify-between">
                <h2 class="text-lg font-medium text-gray-900 dark:text-white">Recent Alerts</h2>
                <a href="/alerts" class="text-sm text-blue-600 dark:text-blue-400 hover:underline">
                    View all
                </a>
            </div>

            <div id="recent-alerts"
                 class="bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden"
                 hx-get="/partials/recent-alerts"
                 hx-trigger="every 15s"
                 hx-swap="innerHTML">
                {% include "partials/recent_alerts.html" with alerts=stats.recent_alerts %}
            </div>
        </div>
    </div>

    <!-- Recent Jobs -->
    <div class="space-y-4">
        <div class="flex items-center justify-between">
            <h2 class="text-lg font-medium text-gray-900 dark:text-white">Recent Jobs (24h)</h2>
            <a href="/jobs" class="text-sm text-blue-600 dark:text-blue-400 hover:underline">
                View all jobs
            </a>
        </div>

        {% if recent_jobs %}
        <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
            {% for job in recent_jobs %}
            {% include "components/job_card.html" with job=job %}
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-12 text-gray-500 dark:text-gray-400">
            <p>No jobs in the last 24 hours</p>
        </div>
        {% endif %}
    </div>

    <!-- Projects Overview -->
    {% if stats.projects %}
    <div class="space-y-4">
        <h2 class="text-lg font-medium text-gray-900 dark:text-white">Projects</h2>

        <div class="bg-white dark:bg-gray-800 shadow overflow-hidden sm:rounded-lg">
            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                <thead class="bg-gray-50 dark:bg-gray-900">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                            Project
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                            Total Jobs
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                            Running
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                            Completed
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                            Failed
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                            Groups
                        </th>
                    </tr>
                </thead>
                <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                    {% for project in stats.projects %}
                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <a href="/projects/{{ project.name }}" class="text-sm font-medium text-blue-600 dark:text-blue-400 hover:underline">
                                {{ project.name }}
                            </a>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                            {{ project.total_jobs }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-blue-600 dark:text-blue-400">
                            {{ project.running }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-green-600 dark:text-green-400">
                            {{ project.completed }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-red-600 dark:text-red-400">
                            {{ project.failed }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                            {{ project.groups | length }}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
